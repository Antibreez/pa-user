"use strict";!function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input"),o=e.parentNode.querySelector(".file-load__clear");function n(e){e.preventDefault(),e.stopPropagation()}function i(t){e.classList.add("highlight")}function r(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,n,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,r,!1)})),e.addEventListener("drop",(function(e){var o=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=o,l()}),!1);var l=function(){a(t)},a=function(t){if(t.files&&t.files[0]){var o=new FileReader;o.onload=function(o){e.parentNode.classList.add("loaded"),e.parentNode.querySelector(".file-load__name").textContent=t.files[0].name,window.onInstallationFileDrop&&window.onInstallationFileDrop(),window.onPassportFileDrop&&window.onPassportFileDrop()},o.readAsDataURL(t.files[0])}};t.addEventListener("change",l),o.addEventListener("click",(function(){e.parentNode.classList.remove("loaded"),t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")}))}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t,o;window.addEventListener("resize",(t=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},function(e){o&&clearTimeout(o),o=setTimeout(t,100,e)}));var n=document.querySelector("body");function i(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.addEventListeners()}i.prototype.open=function(){this.modal.classList.add("js-show"),n.classList.add("js__body-no-scroll")},i.prototype.close=function(){this.modal.classList.remove("js-show"),n.classList.remove("js__body-no-scroll")},i.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},i.prototype.onCloseClick=function(){this.close()},i.prototype.onTriggerClick=function(){this.open()},i.prototype.addEventListeners=function(){this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick)},window.Modal=i}(),function(){var e=document.querySelectorAll(".input-phone");if(e[0]){var t=new Inputmask("+7(999) 999-99-99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e.forEach((function(e){e.addEventListener("focus",(function(){e.parentNode.parentNode.classList.add("js-focus")}))})),e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))}))}(),$(window).on("load",(function(){new Swiper(".device-actions__slider-container",{freeMode:!0,slidesPerView:"auto"})})),function(){var e=document.querySelector(".cloud-status__installation-form");if(e){var t=e.querySelector(".cloud-status__installation-company input"),o=(e.querySelectorAll(".cloud-status__installation-file"),e.querySelector(".input-file__input")),n=e.querySelector(".file-load__clear"),i=e.querySelector(".cloud-status__installation-form-send"),r=function(){return""!==o.value&&""!==t.value},l=function(){r()&&i.hasAttribute("disabled")&&i.removeAttribute("disabled"),r()||!i.hasAttribute("disabled")&&i.setAttribute("disabled","")};window.onInstallationFileDrop=function(){l()},o.addEventListener("change",window.onInstallationFileDrop),n.addEventListener("click",(function(){i.hasAttribute("disabled")||i.setAttribute("disabled","")})),t.addEventListener("input",l)}}(),document.querySelectorAll("[data-trigger]").forEach((function(e){var t=e.getAttribute("data-trigger"),o=document.querySelector("[data-modal="+t+"]");o&&new Modal(e,o)})),function(){var e=document.querySelector(".contract-modal-trigger"),t=document.querySelector(".contract-modal");if($(".contract-modal__toggle-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".info-block__toggle-icon").toggleClass("opened")})),e&&t)new Modal(e,t)}(),function(){var e=document.querySelectorAll(".device-actions__item-link--freez"),t=document.getElementById("freez-modal");e[0]&&t&&e.forEach((function(e){new Modal(e,t)}))}(),$(window).on("load",(function(){new Swiper(".menu-pa__container",{freeMode:!0,slidesPerView:"auto",breakpoints:{1280:{freeMode:!0,slidesPerView:"auto",allowTouchMove:!1}}})})),function(){var e=document.querySelector(".my-comfort-modal-trigger"),t=document.getElementById("my-comfort-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelector(".my-comfort-plus-modal-trigger"),t=document.getElementById("my-comfort-plus-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelector(".my-comfort-premium-modal-trigger"),t=document.getElementById("my-comfort-premium-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelectorAll(".device-actions__item-link--delete"),t=document.getElementById("not-use-modal"),o=document.querySelector("body");if(e[0]&&t){var n=document.querySelector(".not-use-modal__btn--no");e.forEach((function(e){new Modal(e,t)}));n.addEventListener("click",(function(){t.classList.remove("js-show"),o.classList.remove("js__body-no-scroll")}))}}(),function(){var e=document.querySelector(".cloud-status__card--passport");if(e){var t=e.querySelector('input[name="passport-photo"]'),o=e.querySelector('input[name="person-with-passport-photo"]'),n=e.querySelectorAll(".file-load__clear"),i=e.querySelector(".cloud-status__card-btn--desktop"),r=e.querySelector(".cloud-status__card-btn--mobile"),l=function(){var e=!0;return""!==t.value&&""!==o.value||(e=!1),e},a=function(){i.hasAttribute("disabled")||i.setAttribute("disabled",""),r.hasAttribute("disabled")||r.setAttribute("disabled","")};window.onPassportFileDrop=function(){l()&&(i.hasAttribute("disabled")&&i.removeAttribute("disabled"),r.hasAttribute("disabled")&&r.removeAttribute("disabled")),l()||(!i.hasAttribute("disabled")&&i.setAttribute("disabled",""),!r.hasAttribute("disabled")&&r.setAttribute("disabled",""))},t.addEventListener("change",window.onPassportFileDrop),o.addEventListener("change",window.onPassportFileDrop),n.forEach((function(e){e.addEventListener("click",a)}))}}(),$(".first-payment__devices-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".first-payment__device-toggle-icon").toggleClass("opened")})),function(){var e=document.querySelector(".subscription-modal-trigger"),t=document.querySelector(".subscription-modal");if($(".subscription-modal__toggle-item-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".info-block__toggle-icon").toggleClass("opened")})),e&&t)new Modal(e,t)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJpbnB1dC1maWxlLmpzIiwibW9kYWwuanMiLCJwaG9uZS1tYXNrLmpzIiwic2VhcmNoLmpzIiwiYWN0aW9ucy1zbGlkZXIuanMiLCJjbG91ZC1pbnN0YWxsYXRpb24uanMiLCJjb21tb24tbW9kYWwuanMiLCJjb250cmFjdC1tb2RhbC5qcyIsImZyZWV6LW1vZGFsLmpzIiwibWVudS1wYS5qcyIsIm15LWNvbWZvcnQtbW9kYWwuanMiLCJteS1jb21mb3J0LXBsdXMtbW9kYWwuanMiLCJteS1jb21mb3J0LXByZW1pdW0tbW9kYWwuanMiLCJub3QtdXNlLW1vZGFsLmpzIiwicGFzc3BvcnQtZmlsZXMuanMiLCJwYXltZW50cy1kZXZpY2VzLmpzIiwic3Vic2NyaXB0aW9uLW1vZGFsLmpzIl0sIm5hbWVzIjpbImZpbGVEcm9wQXJlYSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsIm1ha2VGaWxlTG9hZCIsImZpbGVJbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJmaWxlQ2xlYXIiLCJwYXJlbnROb2RlIiwicHJldmVudERlZmF1bHRzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiaGlnaGxpZ2h0IiwiY2xhc3NMaXN0IiwiYWRkIiwidW5oaWdobGlnaHQiLCJyZW1vdmUiLCJmb3JFYWNoIiwiZXZlbnROYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbGVzIiwiZGF0YVRyYW5zZmVyIiwidmFsdWUiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwidHlwZSIsIm9uRmlsZUNoYW5nZSIsInJlYWRVcmwiLCJpbnB1dCIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJ0ZXh0Q29udGVudCIsIm5hbWUiLCJ3aW5kb3ciLCJvbkluc3RhbGxhdGlvbkZpbGVEcm9wIiwib25QYXNzcG9ydEZpbGVEcm9wIiwicmVhZEFzRGF0YVVSTCIsIml0ZW0iLCJ2aCIsImlubmVySGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsImNvbmNhdCIsImZ1bmMiLCJ0aW1lciIsImV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsIiRib2R5IiwiTW9kYWwiLCJ0cmlnZ2VyIiwibW9kYWwiLCJ0aGlzIiwib3ZlcmxheSIsImNsb3NlQnRuIiwib25PdmVybGF5Q2xpY2siLCJiaW5kIiwib25DbG9zZUNsaWNrIiwib25UcmlnZ2VyQ2xpY2siLCJhZGRFdmVudExpc3RlbmVycyIsInByb3RvdHlwZSIsIm9wZW4iLCJjbG9zZSIsInRhcmdldCIsImlucHV0cyIsImltIiwiSW5wdXRtYXNrIiwibWFzayIsIml0ZW1zIiwic3BsaXQiLCJqb2luIiwiY29udGFpbnMiLCJzZWFyY2giLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwiJCIsIm9uIiwiU3dpcGVyIiwiZnJlZU1vZGUiLCJzbGlkZXNQZXJWaWV3IiwiZm9ybSIsImNvbXBhbnkiLCJzZW5kQnRuIiwiaXNGb3JtRmlsbGVkIiwiY2hlY2tJbnB1dHMiLCJoYXNBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJnZXRBdHRyaWJ1dGUiLCJjb250cmFjdEJ0biIsIm1vZGFsQ29udHJhY3QiLCJuZXh0Iiwic2xpZGVUb2dnbGUiLCJjaGlsZHJlbiIsInRvZ2dsZUNsYXNzIiwiJG1vZGFsQnRuIiwiJG1vZGFsIiwiZ2V0RWxlbWVudEJ5SWQiLCJicmVha3BvaW50cyIsIjEyODAiLCJhbGxvd1RvdWNoTW92ZSIsIm5vQnRuIiwidXBsb2FkRmlsZXMiLCJmaWxlMSIsImZpbGUyIiwiY2xlYXJGaWxlIiwic2VuZEJ0bjEiLCJzZW5kQnRuMiIsImZpbGxlZCIsIm9uRmlsZUNsZWFyIiwic3Vic2NyaXB0aW9uQnRuIiwibW9kYWxTdWJzY3JpcHRpb24iXSwibWFwcGluZ3MiOiJBQUFBLGNDQUEsV0FDQSxJQUFBQSxFQUFBQyxTQUFBQyxpQkFBQSxzQkFFQSxTQUFBQyxFQUFBSCxHQUNBLElBQUFJLEVBQUFK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QS9HLFNBQUFJLGNBQUEsK0JBQ0E0RyxFQUFBaEgsU0FBQUksY0FBQSx1QkFPQSxHQUxBd0UsRUFBQSx3Q0FBQUMsR0FBQSxTQUFBLFdBQ0FELEVBQUF0QixNQUFBc0MsT0FBQUMsY0FDQWpCLEVBQUF0QixNQUFBd0MsU0FBQSw0QkFBQUMsWUFBQSxhQUdBZ0IsR0FBQUMsRUFJQSxJQUFBN0QsTUFBQTRELEVBQUFDLEdBYkEiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICB2YXIgZmlsZUlucHV0ID0gZmlsZURyb3BBcmVhLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgdmFyIGZpbGVDbGVhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7IC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGB0YLQsNC90LTQsNGA0YLQvdGL0LUg0YHQvtCx0YvRgtC40Y8g0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsFxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICA7IC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4INC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LAg0L3QsNC0INC90YPQttC90L7QuSDQvtCx0LvQsNGB0YLRjNGOXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9XG5cbiAgICA7IC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZSkge1xuICAgICAgdmFyIGR0ID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICB2YXIgb25GaWxlQ2hhbmdlID0gZnVuY3Rpb24gb25GaWxlQ2hhbmdlKCkge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH07XG5cbiAgICB2YXIgcmVhZFVybCA9IGZ1bmN0aW9uIHJlYWRVcmwoaW5wdXQpIHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19uYW1lJykudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuICAgICAgICAgIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wICYmIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKCk7XG4gICAgICAgICAgd2luZG93Lm9uUGFzc3BvcnRGaWxlRHJvcCAmJiB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBvbkNsZWFyKCkge1xuICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG5cbiAgdmFyIG9uUmVzaXplID0gZnVuY3Rpb24gb25SZXNpemUoKSB7XG4gICAgdmFyIHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIH07XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKG9uUmVzaXplKSk7XG4gIHZhciAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKSB7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLCAxMDAsIGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTW9kYWwodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LmFkZCgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5hZGQoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5vdmVybGF5KSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vblRyaWdnZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgfTtcblxuICB3aW5kb3cuTW9kYWwgPSBNb2RhbDtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtcGhvbmUnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCIrNyg5OTkpIDk5OS05OS05OVwiKTtcbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgdmFyIGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcbiAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdqcy1mb2N1cycpO1xuICAgIH0pO1xuICB9KTtcbiAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpdGVtLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnICYmICFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS52YWx1ZSA9PT0gJycgJiYgaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIGNsb3NlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBzd2lwZXIgPSBuZXcgU3dpcGVyKCcuZGV2aWNlLWFjdGlvbnNfX3NsaWRlci1jb250YWluZXInLCB7XG4gICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJ1xuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWZvcm0nKTtcblxuICBpZiAoIWZvcm0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgY29tcGFueSA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWNvbXBhbnkgaW5wdXQnKTtcbiAgdmFyIGZpbGVJbnB1dEJsb2NrID0gZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCcuY2xvdWQtc3RhdHVzX19pbnN0YWxsYXRpb24tZmlsZScpO1xuICB2YXIgZmlsZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGZpbGVDbGVhciA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTtcbiAgdmFyIHNlbmRCdG4gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2luc3RhbGxhdGlvbi1mb3JtLXNlbmQnKTtcblxuICB2YXIgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24gaXNGb3JtRmlsbGVkKCkge1xuICAgIHZhciBmaWxsZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZpbGVJbnB1dC52YWx1ZSA9PT0gJycgfHwgY29tcGFueS52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWxsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxsZWQ7XG4gIH07XG5cbiAgdmFyIGNoZWNrSW5wdXRzID0gZnVuY3Rpb24gY2hlY2tJbnB1dHMoKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICBzZW5kQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzZW5kQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICAhc2VuZEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc2VuZEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25GaWxlQ2xlYXIgPSBmdW5jdGlvbiBvbkZpbGVDbGVhcigpIHtcbiAgICBpZiAoIXNlbmRCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzZW5kQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wID0gZnVuY3Rpb24gKCkge1xuICAgIGNoZWNrSW5wdXRzKCk7XG4gIH07XG5cbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKTtcbiAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICBjb21wYW55LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgY2hlY2tJbnB1dHMpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHJpZ2dlcl0nKTtcbiAgdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIHZhciBuYW1lID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHJpZ2dlcicpO1xuICAgIHZhciBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsPScgKyBuYW1lICsgJ10nKTtcblxuICAgIGlmIChtb2RhbCkge1xuICAgICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LW1vZGFsLXRyaWdnZXInKTtcbiAgdmFyIG1vZGFsQ29udHJhY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtbW9kYWwnKTtcbiAgJCgnLmNvbnRyYWN0LW1vZGFsX190b2dnbGUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS5jaGlsZHJlbignLmluZm8tYmxvY2tfX3RvZ2dsZS1pY29uJykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcblxuICBpZiAoIWNvbnRyYWN0QnRuIHx8ICFtb2RhbENvbnRyYWN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gbmV3IE1vZGFsKGNvbnRyYWN0QnRuLCBtb2RhbENvbnRyYWN0KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGV2aWNlLWFjdGlvbnNfX2l0ZW0tbGluay0tZnJlZXonKTtcbiAgdmFyICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcmVlei1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuWzBdIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkbW9kYWxCdG4uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCAkbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcignLm1lbnUtcGFfX2NvbnRhaW5lcicsIHtcbiAgICAgIGZyZWVNb2RlOiB0cnVlLFxuICAgICAgc2xpZGVzUGVyVmlldzogJ2F1dG8nLFxuICAgICAgYnJlYWtwb2ludHM6IHtcbiAgICAgICAgMTI4MDoge1xuICAgICAgICAgIGZyZWVNb2RlOiB0cnVlLFxuICAgICAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICAgICAgICBhbGxvd1RvdWNoTW92ZTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1tb2RhbC10cmlnZ2VyJyk7XG4gIHZhciAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXktY29tZm9ydC1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBuZXcgTW9kYWwoJG1vZGFsQnRuLCAkbW9kYWwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5teS1jb21mb3J0LXBsdXMtbW9kYWwtdHJpZ2dlcicpO1xuICB2YXIgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215LWNvbWZvcnQtcGx1cy1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBuZXcgTW9kYWwoJG1vZGFsQnRuLCAkbW9kYWwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5teS1jb21mb3J0LXByZW1pdW0tbW9kYWwtdHJpZ2dlcicpO1xuICB2YXIgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215LWNvbWZvcnQtcHJlbWl1bS1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBuZXcgTW9kYWwoJG1vZGFsQnRuLCAkbW9kYWwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZXZpY2UtYWN0aW9uc19faXRlbS1saW5rLS1kZWxldGUnKTtcbiAgdmFyICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3QtdXNlLW1vZGFsJyk7XG4gIHZhciAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBpZiAoISRtb2RhbEJ0blswXSB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG5vQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdC11c2UtbW9kYWxfX2J0bi0tbm8nKTtcbiAgJG1vZGFsQnRuLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgJG1vZGFsKTtcbiAgfSk7XG5cbiAgdmFyIG9uTm9CdG5DbGljayA9IGZ1bmN0aW9uIG9uTm9CdG5DbGljaygpIHtcbiAgICAkbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIG5vQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25Ob0J0bkNsaWNrKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB1cGxvYWRGaWxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2NhcmQtLXBhc3Nwb3J0Jyk7XG5cbiAgaWYgKCF1cGxvYWRGaWxlcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmaWxlMSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJwYXNzcG9ydC1waG90b1wiXScpO1xuICB2YXIgZmlsZTIgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwicGVyc29uLXdpdGgtcGFzc3BvcnQtcGhvdG9cIl0nKTtcbiAgdmFyIGNsZWFyRmlsZSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gIHZhciBzZW5kQnRuMSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2NhcmQtYnRuLS1kZXNrdG9wJyk7XG4gIHZhciBzZW5kQnRuMiA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2NhcmQtYnRuLS1tb2JpbGUnKTtcblxuICB2YXIgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24gaXNGb3JtRmlsbGVkKCkge1xuICAgIHZhciBmaWxsZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZpbGUxLnZhbHVlID09PSAnJyB8fCBmaWxlMi52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxsZWQ7XG4gIH07XG5cbiAgdmFyIGNoZWNrSW5wdXRzID0gZnVuY3Rpb24gY2hlY2tJbnB1dHMoKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICBzZW5kQnRuMS5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc2VuZEJ0bjEucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgICAgc2VuZEJ0bjIuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHNlbmRCdG4yLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICAhc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHNlbmRCdG4xLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICAhc2VuZEJ0bjIuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHNlbmRCdG4yLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uIG9uRmlsZUNsZWFyKCkge1xuICAgIGlmICghc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzZW5kQnRuMS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cblxuICAgIGlmICghc2VuZEJ0bjIuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzZW5kQnRuMi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wID0gZnVuY3Rpb24gKCkge1xuICAgIGNoZWNrSW5wdXRzKCk7XG4gIH07XG5cbiAgZmlsZTEuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uUGFzc3BvcnRGaWxlRHJvcCk7XG4gIGZpbGUyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3ApO1xuICBjbGVhckZpbGUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmZpcnN0LXBheW1lbnRfX2RldmljZXMtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS5jaGlsZHJlbignLmZpcnN0LXBheW1lbnRfX2RldmljZS10b2dnbGUtaWNvbicpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgc3Vic2NyaXB0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1YnNjcmlwdGlvbi1tb2RhbC10cmlnZ2VyJyk7XG4gIHZhciBtb2RhbFN1YnNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJzY3JpcHRpb24tbW9kYWwnKTtcbiAgJCgnLnN1YnNjcmlwdGlvbi1tb2RhbF9fdG9nZ2xlLWl0ZW0tYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS5jaGlsZHJlbignLmluZm8tYmxvY2tfX3RvZ2dsZS1pY29uJykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcblxuICBpZiAoIXN1YnNjcmlwdGlvbkJ0biB8fCAhbW9kYWxTdWJzY3JpcHRpb24pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBuZXcgTW9kYWwoc3Vic2NyaXB0aW9uQnRuLCBtb2RhbFN1YnNjcmlwdGlvbik7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGNvbnN0IGZpbGVDbGVhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gICAgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSlcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuXG4gICAgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICBsZXQgZHQgPSBlLmRhdGFUcmFuc2ZlclxuICAgICAgbGV0IGZpbGVzID0gZHQuZmlsZXNcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgb25GaWxlQ2hhbmdlKCk7XG5cbiAgICB9O1xuXG4gICAgY29uc3Qgb25GaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlYWRVcmwgPSAoaW5wdXQpID0+IHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWFcbiAgICAgICAgICAgIC5wYXJlbnROb2RlXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpXG4gICAgICAgICAgICAudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuXG4gICAgICAgICAgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AgJiYgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AoKTtcbiAgICAgICAgICB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wICYmIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3AoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbkNsZWFyKCkge1xuICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBtYWtlRmlsZUxvYWQoaXRlbSk7XG4gIH0pO1xufSkoKTtcbiIsIigoKSA9PiB7XG4gIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG5cbiAgY29uc3Qgb25SZXNpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuICB9O1xuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBkZWJvdW5jZShvblJlc2l6ZSkpO1xuXG4gIGNvbnN0ICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpe1xuICAgIHZhciB0aW1lcjtcbiAgICByZXR1cm4gZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgaWYodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuYywxMDAsZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBNb2RhbCAodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcblxuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LmFkZCgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5hZGQoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcGVuKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uT3ZlcmxheUNsaWNrKTtcbiAgICB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25UcmlnZ2VyQ2xpY2spO1xuICB9XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtcGhvbmUnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGltID0gbmV3IElucHV0bWFzayhcIis3KDk5OSkgOTk5LTk5LTk5XCIpO1xuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KVxufSkoKTtcbiIsIigoKSA9PiB7XG4gIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCcpO1xuICBjb25zdCBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2ggKyAuc2VhcmNoLWNsb3NlJyk7XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZSAhPT0gJydcbiAgICAgICAgJiYgIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlID09PSAnJ1xuICAgICAgICAmJiBpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG5cbiAgY2xvc2UuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcbiAgICAgIGlmIChcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgc3dpcGVyID0gbmV3IFN3aXBlcignLmRldmljZS1hY3Rpb25zX19zbGlkZXItY29udGFpbmVyJywge1xuICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgfSk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2luc3RhbGxhdGlvbi1mb3JtJyk7XG5cbiAgaWYgKCFmb3JtKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY29tcGFueSA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWNvbXBhbnkgaW5wdXQnKTtcblxuICBjb25zdCBmaWxlSW5wdXRCbG9jayA9IGZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWZpbGUnKTtcbiAgY29uc3QgZmlsZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgY29uc3QgZmlsZUNsZWFyID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuXG4gIGNvbnN0IHNlbmRCdG4gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2luc3RhbGxhdGlvbi1mb3JtLXNlbmQnKTtcblxuICBjb25zdCBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbigpIHtcbiAgICBsZXQgZmlsbGVkID0gdHJ1ZTtcblxuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgPT09ICcnIHx8IGNvbXBhbnkudmFsdWUgPT09ICcnKSB7XG4gICAgICBmaWxsZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsbGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsbGVkO1xuICB9XG5cbiAgY29uc3QgY2hlY2tJbnB1dHMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoaXNGb3JtRmlsbGVkKCkpIHtcbiAgICAgIHNlbmRCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICAmJiBzZW5kQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICAhc2VuZEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHNlbmRCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghc2VuZEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNlbmRCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCA9IGZ1bmN0aW9uKCkge1xuICAgIGNoZWNrSW5wdXRzKCk7XG4gIH07XG5cbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKTtcbiAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICBjb21wYW55LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgY2hlY2tJbnB1dHMpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHJpZ2dlcl0nKTtcblxuICB0cmlnZ2Vycy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBjb25zdCBuYW1lID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHJpZ2dlcicpO1xuXG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbD0nICsgbmFtZSArICddJyk7XG5cbiAgICBpZiAobW9kYWwpIHtcbiAgICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gICAgfVxuICB9KVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtbW9kYWwtdHJpZ2dlcicpO1xuICBjb25zdCBtb2RhbENvbnRyYWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LW1vZGFsJyk7XG5cbiAgJCgnLmNvbnRyYWN0LW1vZGFsX190b2dnbGUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLmNoaWxkcmVuKCcuaW5mby1ibG9ja19fdG9nZ2xlLWljb24nKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pXG5cbiAgaWYgKCFjb250cmFjdEJ0biB8fCAhbW9kYWxDb250cmFjdCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKGNvbnRyYWN0QnRuLCBtb2RhbENvbnRyYWN0KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0ICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZXZpY2UtYWN0aW9uc19faXRlbS1saW5rLS1mcmVleicpO1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJlZXotbW9kYWwnKTtcblxuICBpZiAoISRtb2RhbEJ0blswXSB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJG1vZGFsQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCAkbW9kYWwpO1xuICB9KTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgc3dpcGVyID0gbmV3IFN3aXBlcignLm1lbnUtcGFfX2NvbnRhaW5lcicsIHtcbiAgICAgIGZyZWVNb2RlOiB0cnVlLFxuICAgICAgc2xpZGVzUGVyVmlldzogJ2F1dG8nLFxuICAgICAgYnJlYWtwb2ludHM6IHtcblxuICAgICAgICAxMjgwOiB7XG4gICAgICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogJ2F1dG8nLFxuICAgICAgICAgIGFsbG93VG91Y2hNb3ZlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgJG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm15LWNvbWZvcnQtbW9kYWwtdHJpZ2dlcicpO1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXktY29tZm9ydC1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IG5ldyBNb2RhbCgkbW9kYWxCdG4sICRtb2RhbCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1wbHVzLW1vZGFsLXRyaWdnZXInKTtcbiAgY29uc3QgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215LWNvbWZvcnQtcGx1cy1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IG5ldyBNb2RhbCgkbW9kYWxCdG4sICRtb2RhbCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1wcmVtaXVtLW1vZGFsLXRyaWdnZXInKTtcbiAgY29uc3QgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215LWNvbWZvcnQtcHJlbWl1bS1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IG5ldyBNb2RhbCgkbW9kYWxCdG4sICRtb2RhbCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGV2aWNlLWFjdGlvbnNfX2l0ZW0tbGluay0tZGVsZXRlJyk7XG4gIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3QtdXNlLW1vZGFsJyk7XG4gIGNvbnN0ICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGlmICghJG1vZGFsQnRuWzBdIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBub0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3QtdXNlLW1vZGFsX19idG4tLW5vJyk7XG5cbiAgJG1vZGFsQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCAkbW9kYWwpO1xuICB9KTtcblxuICBjb25zdCBvbk5vQnRuQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAkbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgbm9CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk5vQnRuQ2xpY2spO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgdXBsb2FkRmlsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19jYXJkLS1wYXNzcG9ydCcpO1xuXG4gIGlmICghdXBsb2FkRmlsZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmaWxlMSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJwYXNzcG9ydC1waG90b1wiXScpO1xuICBjb25zdCBmaWxlMiA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJwZXJzb24td2l0aC1wYXNzcG9ydC1waG90b1wiXScpO1xuICBjb25zdCBjbGVhckZpbGUgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICBjb25zdCBzZW5kQnRuMSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2NhcmQtYnRuLS1kZXNrdG9wJyk7XG4gIGNvbnN0IHNlbmRCdG4yID0gdXBsb2FkRmlsZXMucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19fY2FyZC1idG4tLW1vYmlsZScpO1xuXG4gIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAgIGxldCBmaWxsZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZpbGUxLnZhbHVlID09PSAnJyB8fCBmaWxlMi52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxsZWQ7XG4gIH1cblxuICBjb25zdCBjaGVja0lucHV0cyA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICAmJiBzZW5kQnRuMS5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICBzZW5kQnRuMi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHNlbmRCdG4yLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICAhc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICAmJiBzZW5kQnRuMS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgIXNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICAgJiYgc2VuZEJ0bjIuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzZW5kQnRuMS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgICBpZiAoIXNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2VuZEJ0bjIuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wID0gZnVuY3Rpb24oKSB7XG4gICAgY2hlY2tJbnB1dHMoKTtcbiAgfTtcblxuICBmaWxlMS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wKTtcbiAgZmlsZTIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uUGFzc3BvcnRGaWxlRHJvcCk7XG4gIGNsZWFyRmlsZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICB9KTtcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLmZpcnN0LXBheW1lbnRfX2RldmljZXMtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpXG4gICAgICAuY2hpbGRyZW4oJy5maXJzdC1wYXltZW50X19kZXZpY2UtdG9nZ2xlLWljb24nKVxuICAgICAgLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBzdWJzY3JpcHRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Vic2NyaXB0aW9uLW1vZGFsLXRyaWdnZXInKTtcbiAgY29uc3QgbW9kYWxTdWJzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Vic2NyaXB0aW9uLW1vZGFsJyk7XG5cbiAgJCgnLnN1YnNjcmlwdGlvbi1tb2RhbF9fdG9nZ2xlLWl0ZW0tYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLmNoaWxkcmVuKCcuaW5mby1ibG9ja19fdG9nZ2xlLWljb24nKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pXG5cbiAgaWYgKCFzdWJzY3JpcHRpb25CdG4gfHwgIW1vZGFsU3Vic2NyaXB0aW9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBuZXcgTW9kYWwoc3Vic2NyaXB0aW9uQnRuLCBtb2RhbFN1YnNjcmlwdGlvbik7XG59KSgpO1xuIl19
