"use strict";!function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input"),o=e.parentNode.querySelector(".file-load__clear");function n(e){e.preventDefault(),e.stopPropagation()}function i(t){e.classList.add("highlight")}function r(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,n,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,r,!1)})),e.addEventListener("drop",(function(e){var o=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=o,l()}),!1);var l=function(){a(t)},a=function(t){if(t.files&&t.files[0]){var o=new FileReader;o.onload=function(o){e.parentNode.classList.add("loaded"),e.parentNode.querySelector(".file-load__name").textContent=t.files[0].name,window.onInstallationFileDrop&&window.onInstallationFileDrop(),window.onPassportFileDrop&&window.onPassportFileDrop()},o.readAsDataURL(t.files[0])}};t.addEventListener("change",l),o.addEventListener("click",(function(){e.parentNode.classList.remove("loaded"),t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")}))}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t,o;window.addEventListener("resize",(t=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},function(e){o&&clearTimeout(o),o=setTimeout(t,100,e)}));var n=document.querySelector("body");function i(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.addEventListeners()}i.prototype.open=function(){this.modal.classList.add("js-show"),n.classList.add("js__body-no-scroll")},i.prototype.close=function(){this.modal.classList.remove("js-show"),n.classList.remove("js__body-no-scroll")},i.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},i.prototype.onCloseClick=function(){this.close()},i.prototype.onTriggerClick=function(){this.open()},i.prototype.addEventListeners=function(){this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick)},window.Modal=i}(),function(){var e=document.querySelectorAll(".input-phone");if(e[0]){var t=new Inputmask("+7(999) 999-99-99",{onBeforeMask:function(e,t){return e}});e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e.forEach((function(e){e.addEventListener("focus",(function(){e.parentNode.parentNode.classList.add("js-focus")}))})),e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))}))}(),$(window).on("load",(function(){new Swiper(".device-actions__slider-container",{freeMode:!0,slidesPerView:"auto"})})),function(){var e=document.querySelector(".cloud-status__installation-form");if(e){var t=e.querySelector(".cloud-status__installation-company input"),o=(e.querySelectorAll(".cloud-status__installation-file"),e.querySelector(".input-file__input")),n=e.querySelector(".file-load__clear"),i=e.querySelector(".cloud-status__installation-form-send"),r=function(){return""!==o.value&&""!==t.value},l=function(){r()&&i.hasAttribute("disabled")&&i.removeAttribute("disabled"),r()||!i.hasAttribute("disabled")&&i.setAttribute("disabled","")};window.onInstallationFileDrop=function(){l()},o.addEventListener("change",window.onInstallationFileDrop),n.addEventListener("click",(function(){i.hasAttribute("disabled")||i.setAttribute("disabled","")})),t.addEventListener("input",l)}}(),document.querySelectorAll("[data-trigger]").forEach((function(e){var t=e.getAttribute("data-trigger"),o=document.querySelector("[data-modal="+t+"]");o&&new Modal(e,o)})),function(){var e=document.querySelector(".contract-modal-trigger"),t=document.querySelector(".contract-modal");if($(".contract-modal__toggle-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".info-block__toggle-icon").toggleClass("opened")})),e&&t)new Modal(e,t)}(),function(){var e=document.querySelectorAll(".device-actions__item-link--freez"),t=document.getElementById("freez-modal");e[0]&&t&&e.forEach((function(e){new Modal(e,t)}))}(),$(window).on("load",(function(){new Swiper(".menu-pa__container",{freeMode:!0,slidesPerView:"auto",breakpoints:{1280:{freeMode:!0,slidesPerView:"auto",allowTouchMove:!1}}})})),function(){var e=document.querySelector(".my-comfort-modal-trigger"),t=document.getElementById("my-comfort-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelector(".my-comfort-plus-modal-trigger"),t=document.getElementById("my-comfort-plus-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelector(".my-comfort-premium-modal-trigger"),t=document.getElementById("my-comfort-premium-modal");if(e&&t)new Modal(e,t)}(),function(){var e=document.querySelectorAll(".device-actions__item-link--delete"),t=document.getElementById("not-use-modal"),o=document.querySelector("body");if(e[0]&&t){var n=document.querySelector(".not-use-modal__btn--no");e.forEach((function(e){new Modal(e,t)}));n.addEventListener("click",(function(){t.classList.remove("js-show"),o.classList.remove("js__body-no-scroll")}))}}(),function(){var e=document.querySelector(".cloud-status__card--passport");if(e){var t=e.querySelector('input[name="passport-photo"]'),o=e.querySelector('input[name="person-with-passport-photo"]'),n=e.querySelectorAll(".file-load__clear"),i=e.querySelector(".cloud-status__card-btn--desktop"),r=e.querySelector(".cloud-status__card-btn--mobile"),l=function(){var e=!0;return""!==t.value&&""!==o.value||(e=!1),e},a=function(){i.hasAttribute("disabled")||i.setAttribute("disabled",""),r.hasAttribute("disabled")||r.setAttribute("disabled","")};window.onPassportFileDrop=function(){l()&&(i.hasAttribute("disabled")&&i.removeAttribute("disabled"),r.hasAttribute("disabled")&&r.removeAttribute("disabled")),l()||(!i.hasAttribute("disabled")&&i.setAttribute("disabled",""),!r.hasAttribute("disabled")&&r.setAttribute("disabled",""))},t.addEventListener("change",window.onPassportFileDrop),o.addEventListener("change",window.onPassportFileDrop),n.forEach((function(e){e.addEventListener("click",a)}))}}(),$(".first-payment__devices-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".first-payment__device-toggle-icon").toggleClass("opened")})),function(){var e=document.querySelector(".subscription-modal-trigger"),t=document.querySelector(".subscription-modal");if($(".subscription-modal__toggle-item-btn").on("click",(function(){$(this).next().slideToggle(),$(this).children(".info-block__toggle-icon").toggleClass("opened")})),e&&t)new Modal(e,t)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJpbnB1dC1maWxlLmpzIiwibW9kYWwuanMiLCJwaG9uZS1tYXNrLmpzIiwic2VhcmNoLmpzIiwiYWN0aW9ucy1zbGlkZXIuanMiLCJjbG91ZC1pbnN0YWxsYXRpb24uanMiLCJjb21tb24tbW9kYWwuanMiLCJjb250cmFjdC1tb2RhbC5qcyIsImZyZWV6LW1vZGFsLmpzIiwibWVudS1wYS5qcyIsIm15LWNvbWZvcnQtbW9kYWwuanMiLCJteS1jb21mb3J0LXBsdXMtbW9kYWwuanMiLCJteS1jb21mb3J0LXByZW1pdW0tbW9kYWwuanMiLCJub3QtdXNlLW1vZGFsLmpzIiwicGFzc3BvcnQtZmlsZXMuanMiLCJwYXltZW50cy1kZXZpY2VzLmpzIiwic3Vic2NyaXB0aW9uLW1vZGFsLmpzIl0sIm5hbWVzIjpbImZpbGVEcm9wQXJlYSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsIm1ha2VGaWxlTG9hZCIsImZpbGVJbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJmaWxlQ2xlYXIiLCJwYXJlbnROb2RlIiwicHJldmVudERlZmF1bHRzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiaGlnaGxpZ2h0IiwiY2xhc3NMaXN0IiwiYWRkIiwidW5oaWdobGlnaHQiLCJyZW1vdmUiLCJmb3JFYWNoIiwiZXZlbnROYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbGVzIiwiZGF0YVRyYW5zZmVyIiwidmFsdWUiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwidHlwZSIsIm9uRmlsZUNoYW5nZSIsInJlYWRVcmwiLCJpbnB1dCIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJ0ZXh0Q29udGVudCIsIm5hbWUiLCJ3aW5kb3ciLCJvbkluc3RhbGxhdGlvbkZpbGVEcm9wIiwib25QYXNzcG9ydEZpbGVEcm9wIiwicmVhZEFzRGF0YVVSTCIsIml0ZW0iLCJ2aCIsImlubmVySGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsImNvbmNhdCIsImZ1bmMiLCJ0aW1lciIsImV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsIiRib2R5IiwiTW9kYWwiLCJ0cmlnZ2VyIiwibW9kYWwiLCJ0aGlzIiwib3ZlcmxheSIsImNsb3NlQnRuIiwib25PdmVybGF5Q2xpY2siLCJiaW5kIiwib25DbG9zZUNsaWNrIiwib25UcmlnZ2VyQ2xpY2siLCJhZGRFdmVudExpc3RlbmVycyIsInByb3RvdHlwZSIsIm9wZW4iLCJjbG9zZSIsInRhcmdldCIsImlucHV0cyIsImltIiwiSW5wdXRtYXNrIiwib25CZWZvcmVNYXNrIiwib3B0cyIsIm1hc2siLCJpdGVtcyIsInNwbGl0Iiwiam9pbiIsImNvbnRhaW5zIiwic2VhcmNoIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsIiQiLCJvbiIsIlN3aXBlciIsImZyZWVNb2RlIiwic2xpZGVzUGVyVmlldyIsImZvcm0iLCJjb21wYW55Iiwic2VuZEJ0biIsImlzRm9ybUZpbGxlZCIsImNoZWNrSW5wdXRzIiwiaGFzQXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiZ2V0QXR0cmlidXRlIiwiY29udHJhY3RCdG4iLCJtb2RhbENvbnRyYWN0IiwibmV4dCIsInNsaWRlVG9nZ2xlIiwiY2hpbGRyZW4iLCJ0b2dnbGVDbGFzcyIsIiRtb2RhbEJ0biIsIiRtb2RhbCIsImdldEVsZW1lbnRCeUlkIiwiYnJlYWtwb2ludHMiLCIxMjgwIiwiYWxsb3dUb3VjaE1vdmUiLCJub0J0biIsInVwbG9hZEZpbGVzIiwiZmlsZTEiLCJmaWxlMiIsImNsZWFyRmlsZSIsInNlbmRCdG4xIiwic2VuZEJ0bjIiLCJmaWxsZWQiLCJvbkZpbGVDbGVhciIsInN1YnNjcmlwdGlvbkJ0biIsIm1vZGFsU3Vic2NyaXB0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQSxjQ0FBLFdBQ0EsSUFBQUEsRUFBQUMsU0FBQUMsaUJBQUEsc0JBRUEsU0FBQUMs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LE9BQUFDLGNBQ0FqQixFQUFBeEIsTUFDQTBDLFNBQUEsc0NBQ0FDLFlBQUEsYUNMQSxXQUNBLElBQUFnQixFQUFBakgsU0FBQUksY0FBQSwrQkFDQThHLEVBQUFsSCxTQUFBSSxjQUFBLHVCQU9BLEdBTEEwRSxFQUFBLHdDQUFBQyxHQUFBLFNBQUEsV0FDQUQsRUFBQXhCLE1BQUF3QyxPQUFBQyxjQUNBakIsRUFBQXhCLE1BQUEwQyxTQUFBLDRCQUFBQyxZQUFBLGFBR0FnQixHQUFBQyxFQUlBLElBQUEvRCxNQUFBOEQsRUFBQUMsR0FiQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIHZhciBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICB2YXIgZmlsZUNsZWFyID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTsgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyhlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIDsgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDsgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICB2YXIgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIHZhciBmaWxlcyA9IGR0LmZpbGVzO1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmaWxlSW5wdXQuZmlsZXMgPSBmaWxlcztcbiAgICAgIG9uRmlsZUNoYW5nZSgpO1xuICAgIH1cblxuICAgIDtcblxuICAgIHZhciBvbkZpbGVDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpbGVDaGFuZ2UoKSB7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfTtcblxuICAgIHZhciByZWFkVXJsID0gZnVuY3Rpb24gcmVhZFVybChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgICAgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AgJiYgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AoKTtcbiAgICAgICAgICB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wICYmIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3AoKTtcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIG9uQ2xlYXIoKSB7XG4gICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xlYXIpO1xuICB9XG5cbiAgd2luZG93Lm1ha2VGaWxlTG9hZCA9IG1ha2VGaWxlTG9hZDtcblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcblxuICB2YXIgb25SZXNpemUgPSBmdW5jdGlvbiBvblJlc2l6ZSgpIHtcbiAgICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgfTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2Uob25SZXNpemUpKTtcbiAgdmFyICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpIHtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsIDEwMCwgZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBNb2RhbCh0cmlnZ2VyLCBtb2RhbCkge1xuICAgIHRoaXMudHJpZ2dlciA9IHRyaWdnZXI7XG4gICAgdGhpcy5tb2RhbCA9IG1vZGFsO1xuICAgIHRoaXMub3ZlcmxheSA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gICAgdGhpcy5jbG9zZUJ0biA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uT3ZlcmxheUNsaWNrKTtcbiAgICB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25UcmlnZ2VyQ2xpY2spO1xuICB9O1xuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1waG9uZScpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIis3KDk5OSkgOTk5LTk5LTk5XCIsIHtcbiAgICBvbkJlZm9yZU1hc2s6IGZ1bmN0aW9uIG9uQmVmb3JlTWFzayh2YWx1ZSwgb3B0cykge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgfSk7XG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoJyk7XG4gIHZhciBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2ggKyAuc2VhcmNoLWNsb3NlJyk7XG4gIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZnVuY3Rpb24gKCkge1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgICB9KTtcbiAgfSk7XG4gIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJykge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtLnZhbHVlICE9PSAnJyAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09ICcnICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBjbG9zZS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcblxuICAgICAgaWYgKHNlYXJjaC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcignLmRldmljZS1hY3Rpb25zX19zbGlkZXItY29udGFpbmVyJywge1xuICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bydcbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2luc3RhbGxhdGlvbi1mb3JtJyk7XG5cbiAgaWYgKCFmb3JtKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNvbXBhbnkgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2luc3RhbGxhdGlvbi1jb21wYW55IGlucHV0Jyk7XG4gIHZhciBmaWxlSW5wdXRCbG9jayA9IGZvcm0ucXVlcnlTZWxlY3RvckFsbCgnLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWZpbGUnKTtcbiAgdmFyIGZpbGVJbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIHZhciBmaWxlQ2xlYXIgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gIHZhciBzZW5kQnRuID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19pbnN0YWxsYXRpb24tZm9ybS1zZW5kJyk7XG5cbiAgdmFyIGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uIGlzRm9ybUZpbGxlZCgpIHtcbiAgICB2YXIgZmlsbGVkID0gdHJ1ZTtcblxuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgPT09ICcnIHx8IGNvbXBhbnkudmFsdWUgPT09ICcnKSB7XG4gICAgICBmaWxsZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsbGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsbGVkO1xuICB9O1xuXG4gIHZhciBjaGVja0lucHV0cyA9IGZ1bmN0aW9uIGNoZWNrSW5wdXRzKCkge1xuICAgIGlmIChpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgc2VuZEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc2VuZEJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgIXNlbmRCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHNlbmRCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uRmlsZUNsZWFyID0gZnVuY3Rpb24gb25GaWxlQ2xlYXIoKSB7XG4gICAgaWYgKCFzZW5kQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2VuZEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjaGVja0lucHV0cygpO1xuICB9O1xuXG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCk7XG4gIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRmlsZUNsZWFyKTtcbiAgY29tcGFueS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGNoZWNrSW5wdXRzKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB0cmlnZ2VycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRyaWdnZXJdJyk7XG4gIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICB2YXIgbmFtZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXRyaWdnZXInKTtcbiAgICB2YXIgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbD0nICsgbmFtZSArICddJyk7XG5cbiAgICBpZiAobW9kYWwpIHtcbiAgICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1tb2RhbC10cmlnZ2VyJyk7XG4gIHZhciBtb2RhbENvbnRyYWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LW1vZGFsJyk7XG4gICQoJy5jb250cmFjdC1tb2RhbF9fdG9nZ2xlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuY2hpbGRyZW4oJy5pbmZvLWJsb2NrX190b2dnbGUtaWNvbicpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG5cbiAgaWYgKCFjb250cmFjdEJ0biB8fCAhbW9kYWxDb250cmFjdCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IG5ldyBNb2RhbChjb250cmFjdEJ0biwgbW9kYWxDb250cmFjdCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgJG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZS1hY3Rpb25zX19pdGVtLWxpbmstLWZyZWV6Jyk7XG4gIHZhciAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJlZXotbW9kYWwnKTtcblxuICBpZiAoISRtb2RhbEJ0blswXSB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJG1vZGFsQnRuLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgJG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5tZW51LXBhX19jb250YWluZXInLCB7XG4gICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICAgIGJyZWFrcG9pbnRzOiB7XG4gICAgICAgIDEyODA6IHtcbiAgICAgICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICAgICAgYWxsb3dUb3VjaE1vdmU6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgJG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm15LWNvbWZvcnQtbW9kYWwtdHJpZ2dlcicpO1xuICB2YXIgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215LWNvbWZvcnQtbW9kYWwnKTtcblxuICBpZiAoISRtb2RhbEJ0biB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1wbHVzLW1vZGFsLXRyaWdnZXInKTtcbiAgdmFyICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdteS1jb21mb3J0LXBsdXMtbW9kYWwnKTtcblxuICBpZiAoISRtb2RhbEJ0biB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1wcmVtaXVtLW1vZGFsLXRyaWdnZXInKTtcbiAgdmFyICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdteS1jb21mb3J0LXByZW1pdW0tbW9kYWwnKTtcblxuICBpZiAoISRtb2RhbEJ0biB8fCAhJG1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGV2aWNlLWFjdGlvbnNfX2l0ZW0tbGluay0tZGVsZXRlJyk7XG4gIHZhciAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm90LXVzZS1tb2RhbCcpO1xuICB2YXIgJGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgaWYgKCEkbW9kYWxCdG5bMF0gfHwgISRtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBub0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ub3QtdXNlLW1vZGFsX19idG4tLW5vJyk7XG4gICRtb2RhbEJ0bi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sICRtb2RhbCk7XG4gIH0pO1xuXG4gIHZhciBvbk5vQnRuQ2xpY2sgPSBmdW5jdGlvbiBvbk5vQnRuQ2xpY2soKSB7XG4gICAgJG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfTtcblxuICBub0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTm9CdG5DbGljayk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdXBsb2FkRmlsZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19jYXJkLS1wYXNzcG9ydCcpO1xuXG4gIGlmICghdXBsb2FkRmlsZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZmlsZTEgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPVwicGFzc3BvcnQtcGhvdG9cIl0nKTtcbiAgdmFyIGZpbGUyID0gdXBsb2FkRmlsZXMucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInBlcnNvbi13aXRoLXBhc3Nwb3J0LXBob3RvXCJdJyk7XG4gIHZhciBjbGVhckZpbGUgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yQWxsKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICB2YXIgc2VuZEJ0bjEgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19jYXJkLWJ0bi0tZGVza3RvcCcpO1xuICB2YXIgc2VuZEJ0bjIgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19jYXJkLWJ0bi0tbW9iaWxlJyk7XG5cbiAgdmFyIGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uIGlzRm9ybUZpbGxlZCgpIHtcbiAgICB2YXIgZmlsbGVkID0gdHJ1ZTtcblxuICAgIGlmIChmaWxlMS52YWx1ZSA9PT0gJycgfHwgZmlsZTIudmFsdWUgPT09ICcnKSB7XG4gICAgICBmaWxsZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsbGVkO1xuICB9O1xuXG4gIHZhciBjaGVja0lucHV0cyA9IGZ1bmN0aW9uIGNoZWNrSW5wdXRzKCkge1xuICAgIGlmIChpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgc2VuZEJ0bjEuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHNlbmRCdG4xLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgIHNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzZW5kQnRuMi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgIXNlbmRCdG4xLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzZW5kQnRuMS5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgIXNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzZW5kQnRuMi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25GaWxlQ2xlYXIgPSBmdW5jdGlvbiBvbkZpbGVDbGVhcigpIHtcbiAgICBpZiAoIXNlbmRCdG4xLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2VuZEJ0bjEuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG5cbiAgICBpZiAoIXNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2VuZEJ0bjIuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH07XG5cbiAgd2luZG93Lm9uUGFzc3BvcnRGaWxlRHJvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjaGVja0lucHV0cygpO1xuICB9O1xuXG4gIGZpbGUxLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3ApO1xuICBmaWxlMi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wKTtcbiAgY2xlYXJGaWxlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5maXJzdC1wYXltZW50X19kZXZpY2VzLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuY2hpbGRyZW4oJy5maXJzdC1wYXltZW50X19kZXZpY2UtdG9nZ2xlLWljb24nKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHN1YnNjcmlwdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJzY3JpcHRpb24tbW9kYWwtdHJpZ2dlcicpO1xuICB2YXIgbW9kYWxTdWJzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Vic2NyaXB0aW9uLW1vZGFsJyk7XG4gICQoJy5zdWJzY3JpcHRpb24tbW9kYWxfX3RvZ2dsZS1pdGVtLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuY2hpbGRyZW4oJy5pbmZvLWJsb2NrX190b2dnbGUtaWNvbicpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG5cbiAgaWYgKCFzdWJzY3JpcHRpb25CdG4gfHwgIW1vZGFsU3Vic2NyaXB0aW9uKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gbmV3IE1vZGFsKHN1YnNjcmlwdGlvbkJ0biwgbW9kYWxTdWJzY3JpcHRpb24pO1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICBjb25zdCBmaWxlQ2xlYXIgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICAgIC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGB0YLQsNC90LTQsNGA0YLQvdGL0LUg0YHQvtCx0YvRgtC40Y8g0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsFxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMgKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfTtcblxuICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4INC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LAg0L3QsNC0INC90YPQttC90L7QuSDQvtCx0LvQsNGB0YLRjNGOXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSlcbiAgICB9KTtcblxuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSlcbiAgICB9KVxuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgIH07XG5cbiAgICAvL1xuXG4gICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wLCBmYWxzZSlcblxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZSkge1xuICAgICAgbGV0IGR0ID0gZS5kYXRhVHJhbnNmZXJcbiAgICAgIGxldCBmaWxlcyA9IGR0LmZpbGVzXG5cbiAgICAgIGlmIChmaWxlSW5wdXQuZmlsZXMgJiYgZmlsZUlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmaWxlSW5wdXQuZmlsZXMgPSBmaWxlcztcbiAgICAgIG9uRmlsZUNoYW5nZSgpO1xuXG4gICAgfTtcblxuICAgIGNvbnN0IG9uRmlsZUNoYW5nZSA9ICgpID0+IHtcbiAgICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCByZWFkVXJsID0gKGlucHV0KSA9PiB7XG4gICAgICBpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7XG4gICAgICAgICAgZmlsZURyb3BBcmVhXG4gICAgICAgICAgICAucGFyZW50Tm9kZVxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKVxuICAgICAgICAgICAgLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcblxuICAgICAgICAgIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wICYmIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKCk7XG4gICAgICAgICAgd2luZG93Lm9uUGFzc3BvcnRGaWxlRHJvcCAmJiB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25DbGVhcigpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGVhcik7XG4gIH1cblxuICB3aW5kb3cubWFrZUZpbGVMb2FkID0gbWFrZUZpbGVMb2FkO1xuXG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuXG4gIGNvbnN0IG9uUmVzaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcbiAgfTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2Uob25SZXNpemUpKTtcblxuICBjb25zdCAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKXtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgIGlmKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsMTAwLGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTW9kYWwgKHRyaWdnZXIsIG1vZGFsKSB7XG4gICAgdGhpcy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICB0aGlzLm1vZGFsID0gbW9kYWw7XG4gICAgdGhpcy5vdmVybGF5ID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgICB0aGlzLmNsb3NlQnRuID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG5cbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QuYWRkKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5vdmVybGF5KSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vblRyaWdnZXJDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgfVxuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBob25lJyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbSA9IG5ldyBJbnB1dG1hc2soXCIrNyg5OTkpIDk5OS05OS05OVwiLCB7XG4gICAgb25CZWZvcmVNYXNrOiBmdW5jdGlvbih2YWx1ZSwgb3B0cykge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbiAgfSk7XG5cbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGltLm1hc2soaXRlbSk7XG4gIH0pXG59KSgpO1xuIiwiKCgpID0+IHtcbiAgY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoJyk7XG4gIGNvbnN0IGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcblxuICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+e1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUgPT09ICcnXG4gICAgICAgICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuICBjbG9zZS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuICAgICAgaWYgKFxuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufSkoKTtcbiIsIigoKSA9PiB7XG4gICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzd2lwZXIgPSBuZXcgU3dpcGVyKCcuZGV2aWNlLWFjdGlvbnNfX3NsaWRlci1jb250YWluZXInLCB7XG4gICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWZvcm0nKTtcblxuICBpZiAoIWZvcm0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjb21wYW55ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19pbnN0YWxsYXRpb24tY29tcGFueSBpbnB1dCcpO1xuXG4gIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gZm9ybS5xdWVyeVNlbGVjdG9yQWxsKCcuY2xvdWQtc3RhdHVzX19pbnN0YWxsYXRpb24tZmlsZScpO1xuICBjb25zdCBmaWxlSW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBmaWxlQ2xlYXIgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgY29uc3Qgc2VuZEJ0biA9IGZvcm0ucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19faW5zdGFsbGF0aW9uLWZvcm0tc2VuZCcpO1xuXG4gIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAgIGxldCBmaWxsZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZpbGVJbnB1dC52YWx1ZSA9PT0gJycgfHwgY29tcGFueS52YWx1ZSA9PT0gJycpIHtcbiAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWxsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxsZWQ7XG4gIH1cblxuICBjb25zdCBjaGVja0lucHV0cyA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChpc0Zvcm1GaWxsZWQoKSkge1xuICAgICAgc2VuZEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHNlbmRCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICghaXNGb3JtRmlsbGVkKCkpIHtcbiAgICAgICFzZW5kQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICAgJiYgc2VuZEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uRmlsZUNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFzZW5kQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2VuZEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wID0gZnVuY3Rpb24oKSB7XG4gICAgY2hlY2tJbnB1dHMoKTtcbiAgfTtcblxuICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3ApO1xuICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG4gIGNvbXBhbnkuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBjaGVja0lucHV0cyk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgdHJpZ2dlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS10cmlnZ2VyXScpO1xuXG4gIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGNvbnN0IG5hbWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS10cmlnZ2VyJyk7XG5cbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLW1vZGFsPScgKyBuYW1lICsgJ10nKTtcblxuICAgIGlmIChtb2RhbCkge1xuICAgICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgICB9XG4gIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1tb2RhbC10cmlnZ2VyJyk7XG4gIGNvbnN0IG1vZGFsQ29udHJhY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtbW9kYWwnKTtcblxuICAkKCcuY29udHJhY3QtbW9kYWxfX3RvZ2dsZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuY2hpbGRyZW4oJy5pbmZvLWJsb2NrX190b2dnbGUtaWNvbicpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcblxuICBpZiAoIWNvbnRyYWN0QnRuIHx8ICFtb2RhbENvbnRyYWN0KSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBuZXcgTW9kYWwoY29udHJhY3RCdG4sIG1vZGFsQ29udHJhY3QpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgJG1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRldmljZS1hY3Rpb25zX19pdGVtLWxpbmstLWZyZWV6Jyk7XG4gIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcmVlei1tb2RhbCcpO1xuXG4gIGlmICghJG1vZGFsQnRuWzBdIHx8ICEkbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkbW9kYWxCdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sICRtb2RhbCk7XG4gIH0pO1xufSkoKTtcbiIsIigoKSA9PiB7XG4gICQod2luZG93KS5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzd2lwZXIgPSBuZXcgU3dpcGVyKCcubWVudS1wYV9fY29udGFpbmVyJywge1xuICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICBicmVha3BvaW50czoge1xuXG4gICAgICAgIDEyODA6IHtcbiAgICAgICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICAgICAgYWxsb3dUb3VjaE1vdmU6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCAkbW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXktY29tZm9ydC1tb2RhbC10cmlnZ2VyJyk7XG4gIGNvbnN0ICRtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdteS1jb21mb3J0LW1vZGFsJyk7XG5cbiAgaWYgKCEkbW9kYWxCdG4gfHwgISRtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0ICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5teS1jb21mb3J0LXBsdXMtbW9kYWwtdHJpZ2dlcicpO1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXktY29tZm9ydC1wbHVzLW1vZGFsJyk7XG5cbiAgaWYgKCEkbW9kYWxCdG4gfHwgISRtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0ICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5teS1jb21mb3J0LXByZW1pdW0tbW9kYWwtdHJpZ2dlcicpO1xuICBjb25zdCAkbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXktY29tZm9ydC1wcmVtaXVtLW1vZGFsJyk7XG5cbiAgaWYgKCEkbW9kYWxCdG4gfHwgISRtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKCRtb2RhbEJ0biwgJG1vZGFsKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0ICRtb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZXZpY2UtYWN0aW9uc19faXRlbS1saW5rLS1kZWxldGUnKTtcbiAgY29uc3QgJG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdC11c2UtbW9kYWwnKTtcbiAgY29uc3QgJGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgaWYgKCEkbW9kYWxCdG5bMF0gfHwgISRtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG5vQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdC11c2UtbW9kYWxfX2J0bi0tbm8nKTtcblxuICAkbW9kYWxCdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sICRtb2RhbCk7XG4gIH0pO1xuXG4gIGNvbnN0IG9uTm9CdG5DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICRtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBub0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTm9CdG5DbGljayk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCB1cGxvYWRGaWxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbG91ZC1zdGF0dXNfX2NhcmQtLXBhc3Nwb3J0Jyk7XG5cbiAgaWYgKCF1cGxvYWRGaWxlcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGZpbGUxID0gdXBsb2FkRmlsZXMucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInBhc3Nwb3J0LXBob3RvXCJdJyk7XG4gIGNvbnN0IGZpbGUyID0gdXBsb2FkRmlsZXMucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInBlcnNvbi13aXRoLXBhc3Nwb3J0LXBob3RvXCJdJyk7XG4gIGNvbnN0IGNsZWFyRmlsZSA9IHVwbG9hZEZpbGVzLnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gIGNvbnN0IHNlbmRCdG4xID0gdXBsb2FkRmlsZXMucXVlcnlTZWxlY3RvcignLmNsb3VkLXN0YXR1c19fY2FyZC1idG4tLWRlc2t0b3AnKTtcbiAgY29uc3Qgc2VuZEJ0bjIgPSB1cGxvYWRGaWxlcy5xdWVyeVNlbGVjdG9yKCcuY2xvdWQtc3RhdHVzX19jYXJkLWJ0bi0tbW9iaWxlJyk7XG5cbiAgY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gICAgbGV0IGZpbGxlZCA9IHRydWU7XG5cbiAgICBpZiAoZmlsZTEudmFsdWUgPT09ICcnIHx8IGZpbGUyLnZhbHVlID09PSAnJykge1xuICAgICAgZmlsbGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZpbGxlZDtcbiAgfVxuXG4gIGNvbnN0IGNoZWNrSW5wdXRzID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpKSB7XG4gICAgICBzZW5kQnRuMS5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHNlbmRCdG4xLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgIHNlbmRCdG4yLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICAgJiYgc2VuZEJ0bjIucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICghaXNGb3JtRmlsbGVkKCkpIHtcbiAgICAgICFzZW5kQnRuMS5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHNlbmRCdG4xLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICAhc2VuZEJ0bjIuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICAmJiBzZW5kQnRuMi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uRmlsZUNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCFzZW5kQnRuMS5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNlbmRCdG4xLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICAgIGlmICghc2VuZEJ0bjIuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzZW5kQnRuMi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3AgPSBmdW5jdGlvbigpIHtcbiAgICBjaGVja0lucHV0cygpO1xuICB9O1xuXG4gIGZpbGUxLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vblBhc3Nwb3J0RmlsZURyb3ApO1xuICBmaWxlMi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25QYXNzcG9ydEZpbGVEcm9wKTtcbiAgY2xlYXJGaWxlLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG4gIH0pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZmlyc3QtcGF5bWVudF9fZGV2aWNlcy1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcylcbiAgICAgIC5jaGlsZHJlbignLmZpcnN0LXBheW1lbnRfX2RldmljZS10b2dnbGUtaWNvbicpXG4gICAgICAudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJzY3JpcHRpb24tbW9kYWwtdHJpZ2dlcicpO1xuICBjb25zdCBtb2RhbFN1YnNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJzY3JpcHRpb24tbW9kYWwnKTtcblxuICAkKCcuc3Vic2NyaXB0aW9uLW1vZGFsX190b2dnbGUtaXRlbS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuY2hpbGRyZW4oJy5pbmZvLWJsb2NrX190b2dnbGUtaWNvbicpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcblxuICBpZiAoIXN1YnNjcmlwdGlvbkJ0biB8fCAhbW9kYWxTdWJzY3JpcHRpb24pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IG5ldyBNb2RhbChzdWJzY3JpcHRpb25CdG4sIG1vZGFsU3Vic2NyaXB0aW9uKTtcbn0pKCk7XG4iXX0=
